<%- include('partials/head', { title: 'Horse Queue', css: 'queue' }) %>

<body>
  <%- include('partials/header-nav', {name: user.username}) %>
  <div id="page-container">
    <div class="row">
      <div class="col">
        <h2 class="text-center my-3">Queue</h2>
      </div>
    </div>
    <div class="row">
      <div class="col- mx-auto w-75">

        <table id="queue" class="table table-striped table-dark">
          <thead>
            <tr role="row">
              <th scope="col" id="left-col">Horse</th>
              <th scope="col">Location</th>
              <th scope="col" id="right-col">Last Visit</th>
              <th scope="col" id="assigned">Assigned To Me</th>
              <th scope="col" id="button" data-orderable="false"></th>
            </tr>
          </thead>
          <tbody>
            <% for (horse of horses) { %>
            <%-  include('partials/queue-item', { horse, scripts }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <%- include('partials/footer') %>

</body>


<script>
  //Filters Table Assigned Horses
  $(document).ready(function () {

    var table = $('#queue').DataTable({
      bPaginate: false,
      stateSave: true,
      "dom": '<"checkbox-area">rftilp',
      "initComplete": function (settings, json) {
        if (localStorage.input === 'true') {
          $.fn.dataTable.ext.search.push(
            function (settings, data, dataIndex) {
              return data[3].trim() === "Yes"
            }
          )
        }
      }
    })
    $("div.checkbox-area").html('<input id="view-assigned" class ="form-check-input"  type="checkbox" View Assigned Horses>  <label class="form-check-label" for="checkbox">View Assigned Horses</label');


    table.draw()

    $('#view-assigned').on('change', function () {
      if ($(this).is(':checked')) {
        $.fn.dataTable.ext.search.push(
          function (settings, data, dataIndex) {
            return data[3].trim() === "Yes"
          }
        )
      } else {
        $.fn.dataTable.ext.search.pop()
      }
      table.draw()
    })
    $(function () {
      var test = localStorage.input === 'true' ? true : false;
      $('#view-assigned').prop('checked', test || false);
    });

    $('#view-assigned').on('change', function () {
      localStorage.input = $(this).is(':checked');
    });

  })


</script>
