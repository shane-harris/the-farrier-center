<%- include('partials/head', { title: 'Horse Queue', css: 'queue' }) %>

<body>
  <%- include('partials/header-nav', {name: user.username}) %>
  <div id="page-container">
    <div class="row">
      <div class="col">
        <h2 class="text-center my-3">Queue</h2>
      </div>
    </div>
    <div class="row">
      <div class="col">

        <table id="queue" class="table table-striped table-dark" width="95%">
          <thead>
            <tr role="row">
              <th scope="col" id="left-col">Horse</th>
              <th scope="col">Location</th>
              <th scope="col" id="right-col">Last Visit</th>
              <th scope="col" id="assigned">Assigned To Me</th>
              <th scope="col" id="button" data-orderable="false"></th>
            </tr>
          </thead>
          <tbody>
            <% for (horse of horses) { %>
            <%-  include('partials/queue-item', { horse, scripts }) %>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
    <%- include('partials/footer') %>

</body>


<script>
  //Filters Table Assigned Horses
  $(document).ready(function () {

    var table = $('#queue').DataTable({
      'responsive': true,
      responsive: {
        details: true
      },
      "order": [[2, "asc"]],
      "bPaginate": false,
      columnDefs: [
        { responsivePriority: 1, targets: 0 },
        { responsivePriority: 2, targets: -1 },
        { responsivePriority: 3, targets: 2 }
      ],
      "dom": '<"row"<"col"<"checkbox-area">><"col"fr>>tilpr'
    })
    $("div.checkbox-area").html('<input id="checkbox" class ="form-check-input"  type="checkbox" View Assigned Horses>  <label class="form-check-label" for="checkbox">Assigned Horses</label');

    if ($('#checkbox').is(':checked')) {
      $.fn.dataTable.ext.search.push(
        function (settings, data, dataIndex) {
          return data[3].trim() === "Yes"
        }
      )
    } else {
      $.fn.dataTable.ext.search.pop()
    }
    table.draw()

    $('#checkbox').on('change', function () {
      if ($(this).is(':checked')) {
        $.fn.dataTable.ext.search.push(
          function (settings, data, dataIndex) {
            return data[3].trim() === "Yes"
          }
        )
      } else {
        $.fn.dataTable.ext.search.pop()
      }
      table.draw()
    })
  })
</script>
